# 快速开始指南

## 在云服务器上部署的完整步骤

### 1. 准备工作

连接到你的云服务器：
```bash
ssh user@your-server-ip
```

### 2. 克隆或上传代码

将项目文件上传到服务器，或创建项目目录：
```bash
mkdir -p ~/qa-system
cd ~/qa-system
```

将以下文件上传到该目录：
- `requirements.txt`
- `model.py`
- `embedding_model.py`
- `get_vector.py`
- `main.py`
- `knowledge.txt`
- `install.sh`

### 3. 安装依赖

#### 方法1：使用安装脚本（推荐）

```bash
chmod +x install.sh
./install.sh
```

#### 方法2：手动安装

```bash
# 升级pip
pip3 install --upgrade pip

# 安装依赖
pip3 install -r requirements.txt

# 如果有GPU（可选）
pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### 4. 准备知识库

编辑或替换 `knowledge.txt` 文件，填入你的知识库内容：

```bash
nano knowledge.txt
# 或
vim knowledge.txt
```

### 5. 创建向量数据库

```bash
python3 get_vector.py
```

**预计时间**: 首次运行需要下载8GB的embedding模型，根据网络速度可能需要10-30分钟。

**输出示例**:
```
开始处理知识库文件: knowledge.txt
已加载文档数量: 1
切分后的文档块数量: 15
正在加载嵌入模型...
正在从ModelScope加载嵌入模型: Qwen/Qwen3-Embedding-4B
使用设备: cuda
嵌入模型加载完成！
正在创建向量数据库...
向量数据库已保存到: ./faiss/knowledge
```

### 6. 启动问答系统

```bash
python3 main.py
```

**预计时间**: 首次运行需要下载6GB的LLM模型，根据网络速度可能需要10-20分钟。

**输出示例**:
```
==================================================
正在初始化QA系统...
==================================================

1. 加载嵌入模型...
正在从ModelScope加载嵌入模型: Qwen/Qwen3-Embedding-4B
使用设备: cuda
嵌入模型加载完成！

2. 加载向量数据库...
向量数据库加载完成！

3. 加载对话模型...
正在从ModelScope加载模型: Qwen/Qwen2.5-3B-Instruct
使用设备: cuda
模型加载完成！

==================================================
QA系统初始化完成！
==================================================
```

### 7. 开始问答

系统启动后会进入交互式模式：

```
进入交互式问答模式
输入 'quit' 或 'exit' 退出
输入 'clear' 清空对话历史
--------------------------------------------------

请输入您的问题: 
```

输入你的问题即可获得基于知识库的回答！

## 后台运行（可选）

如果需要系统持续运行，可以使用 `screen` 或 `tmux`：

### 使用 screen

```bash
# 安装screen
sudo apt-get install screen  # Ubuntu/Debian
sudo yum install screen       # CentOS

# 创建新会话
screen -S qa-system

# 运行程序
python3 main.py

# 退出会话（程序继续运行）: Ctrl+A, 然后按 D

# 重新连接会话
screen -r qa-system
```

### 使用 tmux

```bash
# 安装tmux
sudo apt-get install tmux  # Ubuntu/Debian
sudo yum install tmux       # CentOS

# 创建新会话
tmux new -s qa-system

# 运行程序
python3 main.py

# 退出会话（程序继续运行）: Ctrl+B, 然后按 D

# 重新连接会话
tmux attach -t qa-system
```

## 使用 systemd 服务（生产环境）

创建服务文件：

```bash
sudo nano /etc/systemd/system/qa-system.service
```

添加以下内容：

```ini
[Unit]
Description=QA System Service
After=network.target

[Service]
Type=simple
User=your-username
WorkingDirectory=/path/to/qa-system
ExecStart=/usr/bin/python3 /path/to/qa-system/main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

启动服务：

```bash
sudo systemctl daemon-reload
sudo systemctl start qa-system
sudo systemctl enable qa-system  # 开机自启
sudo systemctl status qa-system  # 查看状态
```

## 性能监控

### 查看GPU使用情况

```bash
nvidia-smi
# 或持续监控
watch -n 1 nvidia-smi
```

### 查看内存使用

```bash
free -h
```

### 查看磁盘空间

```bash
df -h
```

## 常见问题排查

### 1. 模型下载慢

设置ModelScope镜像（如果有）：
```bash
export MODELSCOPE_CACHE=/path/to/cache
```

### 2. 内存不足

修改 `model.py`，使用较小的批处理或量化：
```python
torch_dtype=torch.float16  # 使用半精度
```

### 3. 端口被占用（如果需要Web服务）

检查端口：
```bash
netstat -tulpn | grep :端口号
```

### 4. 权限问题

确保有执行权限：
```bash
chmod +x install.sh
chmod +x *.py
```

## 下一步

- 根据实际需求修改 `knowledge.txt`
- 调整模型参数以优化性能
- 集成Web界面（可以使用 Gradio 或 Streamlit）
- 添加日志记录和监控

祝使用愉快！🎉
